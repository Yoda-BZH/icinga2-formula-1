{%- if icingaweb_db %}
[icingaweb_db]
type = "db"
db = "{{ icingaweb_db.type }}"
host = "{{ icingaweb_db.host }}"
port = "{{ icingaweb_db.port }}"
dbname = "{{ icingaweb_db.name }}"
username = "{{ icingaweb_db.user }}"
password = "{{ icingaweb_db.password}}"
charset = ""
persistent = "0"
{%- endif %}


{%- set features = icinga2.get('features', {}) %}

{%- set ido_mysql_db = {'type': 'mysql', 'port': 3306} %}
{%- do  ido_mysql_db.update(features.get('ido_mysql', {})) %}

{%- set ido_pgsql_db = {'type': 'pgsql', 'port': 5432} %}
{%- do  ido_pgsql_db.update(features.get('ido_pgsql', {})) %}

{%- if 'host' in ido_pgsql_db %}
{%-   set icinga_db = ido_pgsql_db %}
{%- elif 'host' in ido_mysql_db %}
{%-   set icinga_db = ido_mysql_db %}
{%- endif %}

{%- if icinga_db %}
[icinga_ido]
type = "db"
db = "{{ icinga_db.type }}"
host = "{{ icinga_db.host }}"
port = "{{ icinga_db.port }}"
dbname = "{{ icinga_db.name }}"
username = "{{ icinga_db.user }}"
password = "{{ icinga_db.password }}"
charset = ""
persistent = "0"
{%- endif %}


{%- if director_db %}
[director_db]
type = "db"
db = "{{ director_db.type }}"
host = "{{ director_db.host }}"
dbname = "{{ director_db.name }}"
username = "{{ director_db.user }}"
password = "{{ director_db.password }}"
charset = "utf8"
{%- endif %}
